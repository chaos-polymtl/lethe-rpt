<!doctype html>
<html class="no-js" lang="en" data-content_root="../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="Applications Overview" href="../applications.html" /><link rel="prev" title="Installation on Apple ARM" href="apple_arm.html" />

    <link rel="shortcut icon" href="../_static/lethe_favicon.ico"/><!-- Generated with Sphinx 7.2.6 and Furo 2023.09.10 -->
        <title>Running Lethe on Digital Research Alliance of Canada Clusters - Lethe documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?v=135e06be" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=eafc0fe6" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?v=36a5483c" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">Lethe  documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  
  <span class="sidebar-brand-text">Lethe  documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1 current has-children"><a class="reference internal" href="installation.html">Installation</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Installation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="regular_installation.html">Regular Installation on Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="windows_wsl.html">Windows with WSL</a></li>
<li class="toctree-l2"><a class="reference internal" href="apple_arm.html">Installation on Apple ARM</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Running Lethe on Digital Research Alliance of Canada Clusters</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../applications.html">Applications Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../structure.html">Folder Structure of Lethe</a></li>
<li class="toctree-l1"><a class="reference internal" href="../first_simulation.html">Launching Your First Simulation</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../parameters/parameters.html">Parameters Guide</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of Parameters Guide</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../parameters/rpt/rpt.html">Radioactive Particle Tracking (RPT)</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of Radioactive Particle Tracking (RPT)</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../parameters/rpt/detector_parameters.html">Detector Parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="../parameters/rpt/fem_reconstruction.html">FEM Reconstruction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../parameters/rpt/parameter_tuning.html">Parameter Tuning</a></li>
<li class="toctree-l3"><a class="reference internal" href="../parameters/rpt/rpt_parameters.html">RPT Parameters</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../examples/examples.html">Examples</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of Examples</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../examples/rpt/rpt.html">Radioactive Particle Tracking (RPT)</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle navigation of Radioactive Particle Tracking (RPT)</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../examples/rpt/photon-count-calculation-in-a-cylindrical-vessel/photon-count-calculation-in-a-cylindrical-vessel.html">Photon Count Calculation in a Cylindrical Vessel</a></li>
<li class="toctree-l3"><a class="reference internal" href="../examples/rpt/tuning-parameters-with-nomad/tuning-parameters-with-nomad.html">Tuning Count Calculation Model Parameters with NOMAD</a></li>
<li class="toctree-l3"><a class="reference internal" href="../examples/rpt/particle-fem-reconstruction/particle-fem-reconstruction.html">Particle FEM Reconstruction</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../referencing.html">Referencing Lethe</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../contributing/contributing.html">Contributing</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle navigation of Contributing</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../contributing/pull-requests.html">Pull Requests</a></li>
<li class="toctree-l2"><a class="reference internal" href="../contributing/documentation.html">Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../contributing/animation-videos.html">Animation Videos</a></li>
</ul>
</li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="running-lethe-on-digital-research-alliance-of-canada-clusters">
<h1>Running Lethe on Digital Research Alliance of Canada Clusters<a class="headerlink" href="#running-lethe-on-digital-research-alliance-of-canada-clusters" title="Link to this heading">#</a></h1>
<section id="setting-up-the-folder-structure">
<h2>Setting-up the Folder Structure<a class="headerlink" href="#setting-up-the-folder-structure" title="Link to this heading">#</a></h2>
<p>In your <code class="docutils literal notranslate"><span class="pre">$HOME</span></code>, create a “dealii” folder and a “lethe-rpt” folder, each containing “build” and “inst” folders:</p>
<div class="copy-button highlight-text notranslate"><div class="highlight"><pre><span></span>mkdir -p {dealii,lethe-rpt}/{build,inst}
</pre></div>
</div>
<p>The deal.II and Lethe projects can then be cloned in their corresponding folders, as indicated later in this tutorial.</p>
<p>After installation is complete, the folder structure will be, for deal.II (and likewise for Lethe):</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">$HOME/dealii/dealii</span></code> for deal.ii git,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">$HOME/dealii/build</span></code> for compilation (<code class="docutils literal notranslate"><span class="pre">cmake</span></code> command),</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">$HOME/dealii/inst</span></code> for installation (<code class="docutils literal notranslate"><span class="pre">ninja</span> <span class="pre">install</span></code> command)</p></li>
</ul>
<p>Folders can be open with the <code class="docutils literal notranslate"><span class="pre">cd</span></code> command (<code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">$folder_path</span></code>).</p>
<p>For the sake of clarity, this is the folder structure considered for the rest of this tutorial.</p>
</section>
<section id="installing-deal-ii">
<h2>Installing deal.II<a class="headerlink" href="#installing-deal-ii" title="Link to this heading">#</a></h2>
<p>All operations must be performed on login nodes.</p>
<p>Load <code class="docutils literal notranslate"><span class="pre">Trilinos</span></code>, <code class="docutils literal notranslate"><span class="pre">Parmetis</span></code> and <code class="docutils literal notranslate"><span class="pre">P4est</span></code>, and their prerequisite modules and set the appropriate environment variables. It is convenient to create a <code class="docutils literal notranslate"><span class="pre">.dealii</span></code> file in your <code class="docutils literal notranslate"><span class="pre">$HOME</span></code> directory that contains the following lines to source the appropriate libraries:</p>
<div class="copy-button highlight-text notranslate"><div class="highlight"><pre><span></span>module load StdEnv/2023
module load trilinos/15.1.1
module load parmetis/4.0.3
module load p4est/2.8.6
export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:$EBROOTTRILINOS/lib64/
export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:$EBROOTP4EST/lib64/
export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:$EBROOTFLEXIBLAS/lib64/
export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:$EBROOTIMKL//mkl/2023.2.0/lib/intel64/
export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:$EBROOTOPENMPI/lib/
source /scinet/vast/etc/vastpreload-openmpi.bash # Only if on Trillium or Nibi

export DEAL_II_DIR=$HOME/dealii/inst/
export PATH=$PATH:$HOME/lethe-rpt/inst/bin/
</pre></div>
</div>
<p>This file needs to be sourced every time you launch a job or you compile deal.II and/or Lethe. Once the file has been created, you can then source it on the terminal with:</p>
<div class="copy-button highlight-text notranslate"><div class="highlight"><pre><span></span>source $HOME/.dealii
</pre></div>
</div>
<p>and use it in your <code class="docutils literal notranslate"><span class="pre">.sh</span></code> script when launching a job (see <a class="reference internal" href="#launching-simulations"><span class="std std-ref">Launching Simulations</span></a> below).</p>
<p>Although Lethe-RPT always supports the master branch of deal.II, we maintain an identical deal.II fork on the CHAOS laboratory organization. This fork is always tested to make sure it works with Lethe. To clone this deal.II fork, execute in <code class="docutils literal notranslate"><span class="pre">$HOME/dealii</span></code> directory:</p>
<div class="copy-button highlight-text notranslate"><div class="highlight"><pre><span></span>git clone https://github.com/chaos-polymtl/dealii.git
</pre></div>
</div>
<p>We can compile <code class="docutils literal notranslate"><span class="pre">dealii</span></code> in the <code class="docutils literal notranslate"><span class="pre">$HOME/dealii/build</span></code> folder, by defining the paths to installation folders of <code class="docutils literal notranslate"><span class="pre">Trilinos</span></code>, <code class="docutils literal notranslate"><span class="pre">Parmetis</span></code> and <code class="docutils literal notranslate"><span class="pre">P4est</span></code>. To increase the speed of this step, we skip <code class="docutils literal notranslate"><span class="pre">dealii</span></code> tests and compile in release mode only.</p>
<div class="copy-button highlight-text notranslate"><div class="highlight"><pre><span></span>cmake ../dealii -DDEAL_II_WITH_MPI=ON -DDEAL_II_WITH_TRILINOS=ON   -DTRILINOS_DIR=$EBROOTTRILINOS  -DDEAL_II_WITH_P4EST=ON  -DDEAL_II_WITH_METIS=ON -DCMAKE_BUILD_TYPE=Release -DCMAKE_INSTALL_PREFIX=$HOME/dealii/inst/ -DDEAL_II_COMPONENT_EXAMPLES=OFF  -DCMAKE_CXX_FLAGS=&quot;-march=native&quot; -G Ninja
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>The -DCMAKE_CXX_FLAGS=”-march=native” works on both Rorqual, Nibi, and Trillium. To ensure that the flag has worked correctly, the cmake output should contain the following information : <code class="docutils literal notranslate"><span class="pre">Vectorization</span> <span class="pre">level:</span>&#160;&#160;&#160; <span class="pre">512</span> <span class="pre">bit</span> <span class="pre">(sse2</span> <span class="pre">avx2</span> <span class="pre">avx512*)</span></code>.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>If you wish to run simulations with over 4B (<span class="math notranslate nohighlight">\(4\cdot 10^9\)</span>) degrees of freedom, you must compile with the <code class="docutils literal notranslate"><span class="pre">DEAL_II_WITH_64BIT_INDICES</span> <span class="pre">=</span> <span class="pre">ON</span></code> flag. Such large simulations should be carried out using the <code class="docutils literal notranslate"><span class="pre">lethe-fluid-matrix-free</span></code> application.</p>
</div>
<p>and:</p>
<div class="copy-button highlight-text notranslate"><div class="highlight"><pre><span></span>nice ninja -j6 install
</pre></div>
</div>
<p>The argument <code class="docutils literal notranslate"><span class="pre">-jX</span></code> specifies the number of processors used for the compilation. On login nodes, a maximum of 6 cores should be used in order to ensure that other users can continue using the cluster without slowdowns. If you use more than 6 cores, your compilation may be terminated automatically.</p>
</section>
<section id="installing-lethe">
<h2>Installing Lethe<a class="headerlink" href="#installing-lethe" title="Link to this heading">#</a></h2>
<p>After installing deal.II, compiling Lethe is relatively straightforward. To compile Lethe, the <code class="docutils literal notranslate"><span class="pre">Trilinos</span></code>, <code class="docutils literal notranslate"><span class="pre">Parmetis</span></code> and <code class="docutils literal notranslate"><span class="pre">P4est</span></code> modules should be loaded.</p>
<p>In the <code class="docutils literal notranslate"><span class="pre">$HOME/lethe-rpt</span></code> directory, download Lethe-RPT:</p>
<div class="copy-button highlight-text notranslate"><div class="highlight"><pre><span></span>git clone https://github.com/chaos-polymtl/lethe-rpt.git
</pre></div>
</div>
<p>To install Lethe-RPT in the <code class="docutils literal notranslate"><span class="pre">$HOME/lethe-rpt/inst</span></code> directory (applications will be in <code class="docutils literal notranslate"><span class="pre">inst/bin</span></code>), run in the <code class="docutils literal notranslate"><span class="pre">$HOME/lethe-rpt/build</span></code> directory:</p>
<div class="copy-button highlight-text notranslate"><div class="highlight"><pre><span></span>cmake ../lethe-rpt  -DDEAL_II_DIR=$HOME/dealii/inst -DCMAKE_BUILD_TYPE=Release -DCMAKE_INSTALL_PREFIX=../inst -DCMAKE_CXX_FLAGS=&quot;-march=native&quot; -G Ninja
nice ninja -j6 install
</pre></div>
</div>
</section>
<section id="copying-local-files">
<span id="id1"></span><h2>Copying Local Files<a class="headerlink" href="#copying-local-files" title="Link to this heading">#</a></h2>
<p>We use <a class="reference external" href="https://alliancecan.ca/en/services/advanced-research-computing/national-services/data-movement-globus">Globus</a> to transfer files between your local machine and the cluster. For more information, visit the <a class="reference external" href="https://docs.alliancecan.ca/wiki/Globus">Globus documentation</a>.</p>
</section>
<section id="launching-simulations">
<span id="id2"></span><h2>Launching Simulations<a class="headerlink" href="#launching-simulations" title="Link to this heading">#</a></h2>
<p>Simulations are sent to the scheduler via batch scripts. Visit the Digital Research Alliance of Canada (Alliance) wiki page for more information about the <a class="reference external" href="https://docs.alliancecan.ca/wiki/What_is_a_scheduler%3F">scheduler</a> and <a class="reference external" href="https://docs.alliancecan.ca/wiki/Running_jobs">running jobs</a>. For your convenience, an example of <code class="docutils literal notranslate"><span class="pre">job.sh</span></code> is given below:</p>
<div class="copy-button highlight-text notranslate"><div class="highlight"><pre><span></span>#!/bin/bash
#SBATCH --account=$yourgroupaccount
#SBATCH --ntasks-per-node=$X #number of parallel tasks per node.
#SBATCH --nodes=1 #number of whole nodes used
#SBATCH --time=1:00:00 #maximum time for the simulation (hh:mm:ss)
#SBATCH --mem=120G #memory usage per node. See cluster specification for maximal amount.
#SBATCH --job-name=$yourjobname
#SBATCH --mail-type=ALL
#SBATCH --mail-user=$your.email.adress@email.provider

source $HOME/.dealii
mpirun $HOME/lethe/inst/bin/$lethe_application_name_wanted $parameter_file_name.prm
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>The <code class="docutils literal notranslate"><span class="pre">--ntasks-per-node</span></code> option is the number of parallel tasks per node. When using a full node, this should correspond to the number of cores available on the node. For example, on Narval, this should be set to 64.</p>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>If you have jobs that need to be launched one after the other, you can add <code class="docutils literal notranslate"><span class="pre">#SBATCH</span> <span class="pre">--dependency=$previous-slurm-job-id</span></code> to your launching script. This will make sure that the job will only start once the previous job has finished.</p>
</div>
<p>The job is sent using:</p>
<div class="copy-button highlight-text notranslate"><div class="highlight"><pre><span></span>sbatch job.sh
</pre></div>
</div>
<p>Status can be followed with the <code class="docutils literal notranslate"><span class="pre">sq</span></code> command: under <code class="docutils literal notranslate"><span class="pre">ST</span></code>, <code class="docutils literal notranslate"><span class="pre">PD</span></code> indicates a pending job, and <code class="docutils literal notranslate"><span class="pre">R</span></code> a running job.</p>
<p>Console outputs are written in <code class="docutils literal notranslate"><span class="pre">slurm-$jobID.out</span></code>. For instance, to display the 20 last lines from this file, use:</p>
<div class="copy-button highlight-text notranslate"><div class="highlight"><pre><span></span>tail -n 20 slurm-$jobID.out
</pre></div>
</div>
</section>
<section id="clusters-specifications">
<h2>Clusters Specifications<a class="headerlink" href="#clusters-specifications" title="Link to this heading">#</a></h2>
<p>Please consult the documentation for the machine you are using for the specification of the nodes:</p>
<div class="table-wrapper docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Cluster</p></th>
<th class="head"><p>Tasks per Node</p></th>
<th class="head"><p>Memory per Node</p></th>
<th class="head"><p>URL</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Narval</p></td>
<td><p>64</p></td>
<td><p>248 Go</p></td>
<td><p><a class="reference external" href="https://docs.alliancecan.ca/wiki/Narval/en">https://docs.alliancecan.ca/wiki/Narval/en</a></p></td>
</tr>
<tr class="row-odd"><td><p>Trillium</p></td>
<td><p>192</p></td>
<td><p>755 Go</p></td>
<td><p><a class="reference external" href="https://docs.alliancecan.ca/wiki/Trillium/en">https://docs.alliancecan.ca/wiki/Trillium/en</a></p></td>
</tr>
<tr class="row-even"><td><p>Rorqual</p></td>
<td><p>192</p></td>
<td><p>760 Go</p></td>
<td><p><a class="reference external" href="https://docs.alliancecan.ca/wiki/Rorqual/en">https://docs.alliancecan.ca/wiki/Rorqual/en</a></p></td>
</tr>
<tr class="row-odd"><td><p>Nibi</p></td>
<td><p>192</p></td>
<td><p>754 Go</p></td>
<td><p><a class="reference external" href="https://docs.alliancecan.ca/wiki/Nibi/en">https://docs.alliancecan.ca/wiki/Nibi/en</a></p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="saving-a-ssh-key-linux">
<h2>Saving a SSH Key (Linux)<a class="headerlink" href="#saving-a-ssh-key-linux" title="Link to this heading">#</a></h2>
<p>To save your key on the cluster, so that it is not asked for each log, generate your ssh-key with:</p>
<div class="copy-button highlight-text notranslate"><div class="highlight"><pre><span></span>ssh-keygen
</pre></div>
</div>
<p>which defaults to an RSA key. If you want to specify the key type you want to generate (i.e. ED25519 key), type</p>
<div class="copy-button highlight-text notranslate"><div class="highlight"><pre><span></span>ssh-keygen -t ed25519
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>ED25519 keys are preferred to RSA keys since they are more secure and performant. Seek more information in the <a class="reference external" href="https://docs.gitlab.com/ee/user/ssh.html">GitLab Documentation</a>.</p>
</div>
<p>To upload this local key to your Compute Canada Database account (CCDB) use:</p>
<div class="copy-button highlight-text notranslate"><div class="highlight"><pre><span></span>  ssh-copy-id username@clustername.computecanada.ca
</pre></div>
</div>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="../applications.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Applications Overview</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="apple_arm.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Installation on Apple ARM</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2021-2025, Lethe
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Running Lethe on Digital Research Alliance of Canada Clusters</a><ul>
<li><a class="reference internal" href="#setting-up-the-folder-structure">Setting-up the Folder Structure</a></li>
<li><a class="reference internal" href="#installing-deal-ii">Installing deal.II</a></li>
<li><a class="reference internal" href="#installing-lethe">Installing Lethe</a></li>
<li><a class="reference internal" href="#copying-local-files">Copying Local Files</a></li>
<li><a class="reference internal" href="#launching-simulations">Launching Simulations</a></li>
<li><a class="reference internal" href="#clusters-specifications">Clusters Specifications</a></li>
<li><a class="reference internal" href="#saving-a-ssh-key-linux">Saving a SSH Key (Linux)</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/furo.js?v=32e29ea5"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=7cec7674"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    </body>
</html>